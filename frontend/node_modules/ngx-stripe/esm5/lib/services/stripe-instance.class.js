/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/stripe-instance.class.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BehaviorSubject, from } from 'rxjs';
import { filter, first, map, switchMap } from 'rxjs/operators';
var StripeInstance = /** @class */ (function () {
    function StripeInstance(loader, window, key, options) {
        var _this = this;
        this.loader = loader;
        this.window = window;
        this.key = key;
        this.options = options;
        this.stripe$ = new BehaviorSubject(undefined);
        this.stripe = this.stripe$
            .asObservable()
            .pipe(filter((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return Boolean(stripe); })));
        this.loader
            .asStream()
            .pipe(filter((/**
         * @param {?} status
         * @return {?}
         */
        function (status) { return status.loaded === true; })), first(), map((/**
         * @return {?}
         */
        function () { return ((/** @type {?} */ (_this.window.getNativeWindow()))).Stripe; })))
            .subscribe((/**
         * @param {?} stripeInstance
         * @return {?}
         */
        function (stripeInstance) {
            /** @type {?} */
            var stripe = _this.options
                ? ((/** @type {?} */ (stripeInstance(_this.key, _this.options))))
                : ((/** @type {?} */ (stripeInstance(_this.key))));
            _this.stripe$.next(stripe);
        }));
    }
    /**
     * @return {?}
     */
    StripeInstance.prototype.getInstance = /**
     * @return {?}
     */
    function () {
        return this.stripe$.getValue();
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.elements = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        return this.stripe$.asObservable().pipe(filter((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return Boolean(stripe); })), map((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return stripe.elements(options); })), first());
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.redirectToCheckout = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.redirectToCheckout(options)); })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.confirmAuBecsDebitPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmAuBecsDebitPayment(clientSecret, data));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmBancontactPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmBancontactPayment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmCardPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmCardPayment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmEpsPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmEpsPayment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmFpxPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmFpxPayment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmGiropayPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmGiropayPayment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmIdealPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmIdealPayment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmP24Payment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmP24Payment(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.confirmSepaDebitPayment = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmSepaDebitPayment(clientSecret, data));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @return {?}
     */
    StripeInstance.prototype.handleCardAction = /**
     * @param {?} clientSecret
     * @return {?}
     */
    function (clientSecret) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.handleCardAction(clientSecret)); })), first());
    };
    /**
     * @param {?} paymentMethodData
     * @return {?}
     */
    StripeInstance.prototype.createPaymentMethod = /**
     * @param {?} paymentMethodData
     * @return {?}
     */
    function (paymentMethodData) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.createPaymentMethod(paymentMethodData));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @return {?}
     */
    StripeInstance.prototype.retrievePaymentIntent = /**
     * @param {?} clientSecret
     * @return {?}
     */
    function (clientSecret) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.retrievePaymentIntent(clientSecret)); })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.confirmAuBecsDebitSetup = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmAuBecsDebitSetup(clientSecret, data));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    StripeInstance.prototype.confirmCardSetup = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @param {?=} options
     * @return {?}
     */
    function (clientSecret, data, options) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmCardSetup(clientSecret, data, options));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.confirmSepaDebitSetup = /**
     * @param {?} clientSecret
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(stripe.confirmSepaDebitSetup(clientSecret, data));
        })), first());
    };
    /**
     * @param {?} clientSecret
     * @return {?}
     */
    StripeInstance.prototype.retrieveSetupIntent = /**
     * @param {?} clientSecret
     * @return {?}
     */
    function (clientSecret) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.confirmSepaDebitSetup(clientSecret)); })), first());
    };
    /**
     * @param {?} options
     * @return {?}
     */
    StripeInstance.prototype.paymentRequest = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var stripe = this.getInstance();
        return stripe ? stripe.paymentRequest(options) : undefined;
    };
    /**
     * @param {?} tokenType
     * @param {?} data
     * @return {?}
     */
    StripeInstance.prototype.createToken = /**
     * @param {?} tokenType
     * @param {?} data
     * @return {?}
     */
    function (tokenType, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.createToken(tokenType, data)); })), first());
    };
    /**
     * @param {?} a
     * @param {?=} b
     * @return {?}
     */
    StripeInstance.prototype.createSource = /**
     * @param {?} a
     * @param {?=} b
     * @return {?}
     */
    function (a, b) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.createSource(a, b)); })), first());
    };
    /**
     * @param {?} source
     * @return {?}
     */
    StripeInstance.prototype.retrieveSource = /**
     * @param {?} source
     * @return {?}
     */
    function (source) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) { return from(stripe.retrieveSource(source)); })), first());
    };
    /**
     * @deprecated
     */
    /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.handleCardPayment = /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, element, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(((/** @type {?} */ (stripe))).handleCardPayment(clientSecret, element, data));
        })), first());
    };
    /**
     * @deprecated
     */
    /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.confirmPaymentIntent = /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, element, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(((/** @type {?} */ (stripe))).confirmPaymentIntent(clientSecret, element, data));
        })), first());
    };
    /**
     * @deprecated
     */
    /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.handleCardSetup = /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, element, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(((/** @type {?} */ (stripe))).handleCardSetup(clientSecret, element, data));
        })), first());
    };
    /**
     * @deprecated
     */
    /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.confirmSetupIntent = /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, element, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(((/** @type {?} */ (stripe))).confirmSetupIntent(clientSecret, element, data));
        })), first());
    };
    /**
     * @deprecated
     */
    /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    StripeInstance.prototype.handleFpxPayment = /**
     * @deprecated
     * @param {?} clientSecret
     * @param {?=} element
     * @param {?=} data
     * @return {?}
     */
    function (clientSecret, element, data) {
        return this.stripe.pipe(switchMap((/**
         * @param {?} stripe
         * @return {?}
         */
        function (stripe) {
            return from(((/** @type {?} */ (stripe))).handleFpxPayment(clientSecret, element, data));
        })), first());
    };
    return StripeInstance;
}());
export { StripeInstance };
if (false) {
    /**
     * @type {?}
     * @private
     */
    StripeInstance.prototype.stripe$;
    /** @type {?} */
    StripeInstance.prototype.stripe;
    /**
     * @type {?}
     * @private
     */
    StripeInstance.prototype.loader;
    /**
     * @type {?}
     * @private
     */
    StripeInstance.prototype.window;
    /**
     * @type {?}
     * @private
     */
    StripeInstance.prototype.key;
    /**
     * @type {?}
     * @private
     */
    StripeInstance.prototype.options;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaXBlLWluc3RhbmNlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXN0cmlwZS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9zdHJpcGUtaW5zdGFuY2UuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN6RCxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUEyRC9EO0lBTUUsd0JBQ1UsTUFBMkIsRUFDM0IsTUFBaUIsRUFDakIsR0FBVyxFQUNYLE9BQWtDO1FBSjVDLGlCQW9CQztRQW5CUyxXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQUMzQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLFFBQUcsR0FBSCxHQUFHLENBQVE7UUFDWCxZQUFPLEdBQVAsT0FBTyxDQUEyQjtRQVRwQyxZQUFPLEdBQUcsSUFBSSxlQUFlLENBQXFCLFNBQVMsQ0FBQyxDQUFDO1FBQ3JFLFdBQU0sR0FBRyxJQUFJLENBQUMsT0FBTzthQUNsQixZQUFZLEVBQUU7YUFDZCxJQUFJLENBQUMsTUFBTTs7OztRQUFDLFVBQUMsTUFBTSxJQUFLLE9BQUEsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFmLENBQWUsRUFBQyxDQUFDLENBQUM7UUFRM0MsSUFBSSxDQUFDLE1BQU07YUFDUixRQUFRLEVBQUU7YUFDVixJQUFJLENBQ0gsTUFBTTs7OztRQUFDLFVBQUMsTUFBaUMsSUFBSyxPQUFBLE1BQU0sQ0FBQyxNQUFNLEtBQUssSUFBSSxFQUF0QixDQUFzQixFQUFDLEVBQ3JFLEtBQUssRUFBRSxFQUNQLEdBQUc7OztRQUFDLGNBQU0sT0FBQSxDQUFDLG1CQUFBLEtBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFLEVBQU8sQ0FBQyxDQUFDLE1BQU0sRUFBN0MsQ0FBNkMsRUFBQyxDQUN6RDth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QUFBLE1BQU0sRUFBTyxDQUFDLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFBbEUsQ0FBa0UsRUFDbkUsRUFDRCxLQUFLLEVBQUUsQ0FDUixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHOzs7Ozs7OztJQUNILDJDQUFrQjs7Ozs7OztJQUFsQixVQUNFLFlBQW9CLEVBQ3BCLE9BQVEsRUFDUixJQUFLO1FBS0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDckIsU0FBUzs7OztRQUFDLFVBQUMsTUFBTTtZQUNmLE9BQUEsSUFBSSxDQUFDLENBQUMsbUJBQUEsTUFBTSxFQUFPLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQXJFLENBQXFFLEVBQ3RFLEVBQ0QsS0FBSyxFQUFFLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRzs7Ozs7Ozs7SUFDSCx5Q0FBZ0I7Ozs7Ozs7SUFBaEIsVUFDRSxZQUFvQixFQUNwQixPQUFRLEVBQ1IsSUFBSztRQUtMLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ3JCLFNBQVM7Ozs7UUFBQyxVQUFDLE1BQU07WUFDZixPQUFBLElBQUksQ0FBQyxDQUFDLG1CQUFBLE1BQU0sRUFBTyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUFuRSxDQUFtRSxFQUNwRSxFQUNELEtBQUssRUFBRSxDQUNSLENBQUM7SUFDSixDQUFDO0lBQ0gscUJBQUM7QUFBRCxDQUFDLEFBN2JELElBNmJDOzs7Ozs7O0lBNWJDLGlDQUFxRTs7SUFDckUsZ0NBRTZDOzs7OztJQUczQyxnQ0FBbUM7Ozs7O0lBQ25DLGdDQUF5Qjs7Ozs7SUFDekIsNkJBQW1COzs7OztJQUNuQixpQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGZyb20sIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgZmlyc3QsIG1hcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge1xuICBDb25maXJtQXVCZWNzRGViaXRQYXltZW50RGF0YSxcbiAgQ29uZmlybUF1QmVjc0RlYml0U2V0dXBEYXRhLFxuICBDb25maXJtQmFuY29udGFjdFBheW1lbnREYXRhLFxuICBDb25maXJtQmFuY29udGFjdFBheW1lbnRPcHRpb25zLFxuICBDb25maXJtQ2FyZFBheW1lbnREYXRhLFxuICBDb25maXJtQ2FyZFBheW1lbnRPcHRpb25zLFxuICBDb25maXJtRXBzUGF5bWVudERhdGEsXG4gIENvbmZpcm1FcHNQYXltZW50T3B0aW9ucyxcbiAgQ29uZmlybUZweFBheW1lbnREYXRhLFxuICBDb25maXJtRnB4UGF5bWVudE9wdGlvbnMsXG4gIENvbmZpcm1HaXJvcGF5UGF5bWVudERhdGEsXG4gIENvbmZpcm1HaXJvcGF5UGF5bWVudE9wdGlvbnMsXG4gIENvbmZpcm1JZGVhbFBheW1lbnREYXRhLFxuICBDb25maXJtSWRlYWxQYXltZW50T3B0aW9ucyxcbiAgQ29uZmlybVAyNFBheW1lbnREYXRhLFxuICBDb25maXJtUDI0UGF5bWVudE9wdGlvbnMsXG4gIENvbmZpcm1DYXJkU2V0dXBEYXRhLFxuICBDb25maXJtQ2FyZFNldHVwT3B0aW9ucyxcbiAgQ29uZmlybVNlcGFEZWJpdFBheW1lbnREYXRhLFxuICBDb25maXJtU2VwYURlYml0U2V0dXBEYXRhLFxuICBDcmVhdGVQYXltZW50TWV0aG9kRGF0YSxcbiAgQ3JlYXRlU291cmNlRGF0YSxcbiAgQ3JlYXRlVG9rZW5JYmFuRGF0YSxcbiAgQ3JlYXRlVG9rZW5DYXJkRGF0YSxcbiAgQ3JlYXRlVG9rZW5QaWlEYXRhLFxuICBDcmVhdGVUb2tlbkJhbmtBY2NvdW50RGF0YSxcbiAgUGF5bWVudEludGVudCxcbiAgUGF5bWVudE1ldGhvZCxcbiAgUGF5bWVudFJlcXVlc3QsXG4gIFBheW1lbnRSZXF1ZXN0T3B0aW9ucyxcbiAgUmVkaXJlY3RUb0NoZWNrb3V0T3B0aW9ucyxcbiAgUmV0cmlldmVTb3VyY2VQYXJhbSxcbiAgU2V0dXBJbnRlbnQsXG4gIFN0cmlwZSxcbiAgU3RyaXBlQ2FyZEVsZW1lbnQsXG4gIFN0cmlwZUNhcmROdW1iZXJFbGVtZW50LFxuICBTdHJpcGVDYXJkQ3ZjRWxlbWVudCxcbiAgU3RyaXBlQ29uc3RydWN0b3JPcHRpb25zLFxuICBTdHJpcGVFbGVtZW50cyxcbiAgU3RyaXBlRWxlbWVudHNPcHRpb25zLFxuICBTdHJpcGVFbGVtZW50LFxuICBTdHJpcGVFcnJvcixcbiAgU3RyaXBlSWJhbkVsZW1lbnQsXG4gIFNvdXJjZSxcbiAgVG9rZW4sXG4gIFRva2VuQ3JlYXRlUGFyYW1zXG59IGZyb20gJ0BzdHJpcGUvc3RyaXBlLWpzJztcblxuaW1wb3J0IHsgU3RyaXBlU2VydmljZUludGVyZmFjZSB9IGZyb20gJy4uL2ludGVyZmFjZXMvc3RyaXBlLWluc3RhbmNlLmludGVyZmFjZSc7XG5cbmltcG9ydCB7IFdpbmRvd1JlZiB9IGZyb20gJy4vd2luZG93LXJlZi5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIExhenlTdHJpcGVBUElMb2FkZXIsXG4gIExhenlTdHJpcGVBUElMb2FkZXJTdGF0dXNcbn0gZnJvbSAnLi9hcGktbG9hZGVyLnNlcnZpY2UnO1xuXG5leHBvcnQgY2xhc3MgU3RyaXBlSW5zdGFuY2UgaW1wbGVtZW50cyBTdHJpcGVTZXJ2aWNlSW50ZXJmYWNlIHtcbiAgcHJpdmF0ZSBzdHJpcGUkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxTdHJpcGUgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHN0cmlwZSA9IHRoaXMuc3RyaXBlJFxuICAgIC5hc09ic2VydmFibGUoKVxuICAgIC5waXBlKGZpbHRlcigoc3RyaXBlKSA9PiBCb29sZWFuKHN0cmlwZSkpKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGxvYWRlcjogTGF6eVN0cmlwZUFQSUxvYWRlcixcbiAgICBwcml2YXRlIHdpbmRvdzogV2luZG93UmVmLFxuICAgIHByaXZhdGUga2V5OiBzdHJpbmcsXG4gICAgcHJpdmF0ZSBvcHRpb25zPzogU3RyaXBlQ29uc3RydWN0b3JPcHRpb25zXG4gICkge1xuICAgIHRoaXMubG9hZGVyXG4gICAgICAuYXNTdHJlYW0oKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigoc3RhdHVzOiBMYXp5U3RyaXBlQVBJTG9hZGVyU3RhdHVzKSA9PiBzdGF0dXMubG9hZGVkID09PSB0cnVlKSxcbiAgICAgICAgZmlyc3QoKSxcbiAgICAgICAgbWFwKCgpID0+ICh0aGlzLndpbmRvdy5nZXROYXRpdmVXaW5kb3coKSBhcyBhbnkpLlN0cmlwZSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKHN0cmlwZUluc3RhbmNlOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3Qgc3RyaXBlID0gdGhpcy5vcHRpb25zXG4gICAgICAgICAgPyAoc3RyaXBlSW5zdGFuY2UodGhpcy5rZXksIHRoaXMub3B0aW9ucykgYXMgU3RyaXBlKVxuICAgICAgICAgIDogKHN0cmlwZUluc3RhbmNlKHRoaXMua2V5KSBhcyBTdHJpcGUpO1xuXG4gICAgICAgIHRoaXMuc3RyaXBlJC5uZXh0KHN0cmlwZSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGdldEluc3RhbmNlKCk6IFN0cmlwZSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlJC5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgZWxlbWVudHMob3B0aW9ucz86IFN0cmlwZUVsZW1lbnRzT3B0aW9ucyk6IE9ic2VydmFibGU8U3RyaXBlRWxlbWVudHM+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUkLmFzT2JzZXJ2YWJsZSgpLnBpcGUoXG4gICAgICBmaWx0ZXIoKHN0cmlwZSkgPT4gQm9vbGVhbihzdHJpcGUpKSxcbiAgICAgIG1hcCgoc3RyaXBlKSA9PiBzdHJpcGUuZWxlbWVudHMob3B0aW9ucykpLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICByZWRpcmVjdFRvQ2hlY2tvdXQoXG4gICAgb3B0aW9ucz86IFJlZGlyZWN0VG9DaGVja291dE9wdGlvbnNcbiAgKTogT2JzZXJ2YWJsZTxuZXZlciB8IHsgZXJyb3I6IFN0cmlwZUVycm9yIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PiBmcm9tKHN0cmlwZS5yZWRpcmVjdFRvQ2hlY2tvdXQob3B0aW9ucykpKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUF1QmVjc0RlYml0UGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUF1QmVjc0RlYml0UGF5bWVudERhdGFcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1BdUJlY3NEZWJpdFBheW1lbnQoY2xpZW50U2VjcmV0LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpcm1CYW5jb250YWN0UGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUJhbmNvbnRhY3RQYXltZW50RGF0YSxcbiAgICBvcHRpb25zPzogQ29uZmlybUJhbmNvbnRhY3RQYXltZW50T3B0aW9uc1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybUJhbmNvbnRhY3RQYXltZW50KGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtQ2FyZFBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1DYXJkUGF5bWVudERhdGEsXG4gICAgb3B0aW9ucz86IENvbmZpcm1DYXJkUGF5bWVudE9wdGlvbnNcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1DYXJkUGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEsIG9wdGlvbnMpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUVwc1BheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1FcHNQYXltZW50RGF0YSxcbiAgICBvcHRpb25zPzogQ29uZmlybUVwc1BheW1lbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtRXBzUGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEsIG9wdGlvbnMpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUZweFBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1GcHhQYXltZW50RGF0YSxcbiAgICBvcHRpb25zPzogQ29uZmlybUZweFBheW1lbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtRnB4UGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEsIG9wdGlvbnMpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUdpcm9wYXlQYXltZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGRhdGE/OiBDb25maXJtR2lyb3BheVBheW1lbnREYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtR2lyb3BheVBheW1lbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtR2lyb3BheVBheW1lbnQoY2xpZW50U2VjcmV0LCBkYXRhLCBvcHRpb25zKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpcm1JZGVhbFBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1JZGVhbFBheW1lbnREYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtSWRlYWxQYXltZW50T3B0aW9uc1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybUlkZWFsUGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEsIG9wdGlvbnMpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybVAyNFBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1QMjRQYXltZW50RGF0YSxcbiAgICBvcHRpb25zPzogQ29uZmlybVAyNFBheW1lbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtUDI0UGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEsIG9wdGlvbnMpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybVNlcGFEZWJpdFBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1TZXBhRGViaXRQYXltZW50RGF0YVxuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybVNlcGFEZWJpdFBheW1lbnQoY2xpZW50U2VjcmV0LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGhhbmRsZUNhcmRBY3Rpb24oXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmdcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+IGZyb20oc3RyaXBlLmhhbmRsZUNhcmRBY3Rpb24oY2xpZW50U2VjcmV0KSkpLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjcmVhdGVQYXltZW50TWV0aG9kKFxuICAgIHBheW1lbnRNZXRob2REYXRhOiBDcmVhdGVQYXltZW50TWV0aG9kRGF0YVxuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50TWV0aG9kPzogUGF5bWVudE1ldGhvZDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY3JlYXRlUGF5bWVudE1ldGhvZChwYXltZW50TWV0aG9kRGF0YSkpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICByZXRyaWV2ZVBheW1lbnRJbnRlbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmdcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+IGZyb20oc3RyaXBlLnJldHJpZXZlUGF5bWVudEludGVudChjbGllbnRTZWNyZXQpKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpcm1BdUJlY3NEZWJpdFNldHVwKFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGRhdGE/OiBDb25maXJtQXVCZWNzRGViaXRTZXR1cERhdGFcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgc2V0dXBJbnRlbnQ/OiBTZXR1cEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybUF1QmVjc0RlYml0U2V0dXAoY2xpZW50U2VjcmV0LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpcm1DYXJkU2V0dXAoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1DYXJkU2V0dXBEYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtQ2FyZFNldHVwT3B0aW9uc1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBzZXR1cEludGVudD86IFNldHVwSW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtQ2FyZFNldHVwKGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtU2VwYURlYml0U2V0dXAoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1TZXBhRGViaXRTZXR1cERhdGFcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgc2V0dXBJbnRlbnQ/OiBTZXR1cEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybVNlcGFEZWJpdFNldHVwKGNsaWVudFNlY3JldCwgZGF0YSkpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICByZXRyaWV2ZVNldHVwSW50ZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHNldHVwSW50ZW50PzogU2V0dXBJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+IGZyb20oc3RyaXBlLmNvbmZpcm1TZXBhRGViaXRTZXR1cChjbGllbnRTZWNyZXQpKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIHBheW1lbnRSZXF1ZXN0KG9wdGlvbnM6IFBheW1lbnRSZXF1ZXN0T3B0aW9ucyk6IFBheW1lbnRSZXF1ZXN0IHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBzdHJpcGUgPSB0aGlzLmdldEluc3RhbmNlKCk7XG5cbiAgICByZXR1cm4gc3RyaXBlID8gc3RyaXBlLnBheW1lbnRSZXF1ZXN0KG9wdGlvbnMpIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgY3JlYXRlVG9rZW4oXG4gICAgdG9rZW5UeXBlOiBTdHJpcGVJYmFuRWxlbWVudCxcbiAgICBkYXRhOiBDcmVhdGVUb2tlbkliYW5EYXRhXG4gICk6IE9ic2VydmFibGU8eyB0b2tlbj86IFRva2VuOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+O1xuICBjcmVhdGVUb2tlbihcbiAgICB0b2tlblR5cGU6IFN0cmlwZUNhcmRFbGVtZW50IHwgU3RyaXBlQ2FyZE51bWJlckVsZW1lbnQsXG4gICAgZGF0YT86IENyZWF0ZVRva2VuQ2FyZERhdGFcbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKFxuICAgIHRva2VuVHlwZTogJ3BpaScsXG4gICAgZGF0YTogQ3JlYXRlVG9rZW5QaWlEYXRhXG4gICk6IE9ic2VydmFibGU8eyB0b2tlbj86IFRva2VuOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+O1xuICBjcmVhdGVUb2tlbihcbiAgICB0b2tlblR5cGU6ICdiYW5rX2FjY291bnQnLFxuICAgIGRhdGE6IENyZWF0ZVRva2VuQmFua0FjY291bnREYXRhXG4gICk6IE9ic2VydmFibGU8eyB0b2tlbj86IFRva2VuOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+O1xuICBjcmVhdGVUb2tlbihcbiAgICB0b2tlblR5cGU6ICdjdmNfdXBkYXRlJyxcbiAgICBlbGVtZW50PzogU3RyaXBlQ2FyZEN2Y0VsZW1lbnRcbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKFxuICAgIHRva2VuVHlwZTogJ2FjY291bnQnLFxuICAgIGRhdGE6IFRva2VuQ3JlYXRlUGFyYW1zLkFjY291bnRcbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKFxuICAgIHRva2VuVHlwZTogJ3BlcnNvbicsXG4gICAgZGF0YTogVG9rZW5DcmVhdGVQYXJhbXMuUGVyc29uXG4gICk6IE9ic2VydmFibGU8eyB0b2tlbj86IFRva2VuOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+O1xuICBjcmVhdGVUb2tlbih0b2tlblR5cGUsIGRhdGEpIHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PiBmcm9tKHN0cmlwZS5jcmVhdGVUb2tlbih0b2tlblR5cGUsIGRhdGEpKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNyZWF0ZVNvdXJjZShcbiAgICBlbGVtZW50OiBTdHJpcGVFbGVtZW50LFxuICAgIHNvdXJjZURhdGE6IENyZWF0ZVNvdXJjZURhdGFcbiAgKTogT2JzZXJ2YWJsZTx7IHNvdXJjZT86IFNvdXJjZTsgZXJyb3I/OiBTdHJpcGVFcnJvciB9PjtcbiAgY3JlYXRlU291cmNlKFxuICAgIHNvdXJjZURhdGE6IENyZWF0ZVNvdXJjZURhdGFcbiAgKTogT2JzZXJ2YWJsZTx7IHNvdXJjZT86IFNvdXJjZTsgZXJyb3I/OiBTdHJpcGVFcnJvciB9PjtcbiAgY3JlYXRlU291cmNlKGEsIGI/KTogT2JzZXJ2YWJsZTx7IHNvdXJjZT86IFNvdXJjZTsgZXJyb3I/OiBTdHJpcGVFcnJvciB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT4gZnJvbShzdHJpcGUuY3JlYXRlU291cmNlKGEsIGIpKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIHJldHJpZXZlU291cmNlKFxuICAgIHNvdXJjZTogUmV0cmlldmVTb3VyY2VQYXJhbVxuICApOiBPYnNlcnZhYmxlPHsgc291cmNlPzogU291cmNlOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PiBmcm9tKHN0cmlwZS5yZXRyaWV2ZVNvdXJjZShzb3VyY2UpKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgaGFuZGxlQ2FyZFBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZWxlbWVudD8sXG4gICAgZGF0YT9cbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oKHN0cmlwZSBhcyBhbnkpLmhhbmRsZUNhcmRQYXltZW50KGNsaWVudFNlY3JldCwgZWxlbWVudCwgZGF0YSkpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICovXG4gIGNvbmZpcm1QYXltZW50SW50ZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGVsZW1lbnQ/LFxuICAgIGRhdGE/XG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKChzdHJpcGUgYXMgYW55KS5jb25maXJtUGF5bWVudEludGVudChjbGllbnRTZWNyZXQsIGVsZW1lbnQsIGRhdGEpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqL1xuICBoYW5kbGVDYXJkU2V0dXAoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZWxlbWVudD8sXG4gICAgZGF0YT9cbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgc2V0dXBJbnRlbnQ/OiBTZXR1cEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbSgoc3RyaXBlIGFzIGFueSkuaGFuZGxlQ2FyZFNldHVwKGNsaWVudFNlY3JldCwgZWxlbWVudCwgZGF0YSkpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICovXG4gIGNvbmZpcm1TZXR1cEludGVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBlbGVtZW50PyxcbiAgICBkYXRhP1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBzZXR1cEludGVudD86IFNldHVwSW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKChzdHJpcGUgYXMgYW55KS5jb25maXJtU2V0dXBJbnRlbnQoY2xpZW50U2VjcmV0LCBlbGVtZW50LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgaGFuZGxlRnB4UGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBlbGVtZW50PyxcbiAgICBkYXRhP1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBzZXR1cEludGVudD86IFNldHVwSW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKChzdHJpcGUgYXMgYW55KS5oYW5kbGVGcHhQYXltZW50KGNsaWVudFNlY3JldCwgZWxlbWVudCwgZGF0YSkpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==